import{r as t,m as G,j as e}from"./index-2b00a054.js";import{d as I}from"./GridView-85d728d6.js";import{c as J}from"./chidoanApi-461c2452.js";import"./index.esm-a80e06b2.js";import{u as K,C as Q}from"./index.esm-322da860.js";import{C as W,d as Z}from"./FileDownload-3a33c116.js";import{d as ee}from"./Add-84462153.js";import{S as y}from"./react-select.esm-a86401bf.js";import{c as ae}from"./canboApi-c8a721f9.js";import{d as j}from"./dayjs.min-51d44ca9.js";import{t as N}from"./thongkeApi-29f415fb.js";import{T as te}from"./TableChitietThiduathang-bb08c730.js";import{T as se}from"./TableBangthiduathang-0c308de5.js";import{B as v}from"./Button-c283a03a.js";import"./createSvgIcon-46c59fe3.js";import"./ButtonBase-ca61bcf9.js";import"./Link-ed3a8026.js";import"./LastPage-e02fc572.js";import"./Flag-21a3ac5b.js";import"./Tooltip-608b47d3.js";let le=[{label:"STT",key:"stt"},{label:"Họ tên",key:"hoten"},{label:"Số lượt cờ xanh",key:"blue"},{label:"Số lượt cờ vàng",key:"yellow"}];const _e=()=>{const[S,h]=t.useState(""),[T,x]=t.useState(""),[ne,m]=G(),[w,C]=t.useState([]),[r,Y]=t.useState({label:"",value:""}),[oe,B]=t.useState(null),[_,k]=t.useState(null),[D,E]=t.useState(null),[f,L]=t.useState([]),[M,$]=t.useState(!1),[F,z]=t.useState([]),[i,p]=t.useState(0),[A,H]=t.useState([]),[O,P]=t.useState([]),[d,R]=t.useState(""),[V,g]=t.useState([]),{register:u,handleSubmit:q,control:U,resetField:re,setValue:b,watch:c,formState:{errors:ie}}=K({defaultValues:{chidoans:{label:"Tất cả",value:""},tungay:"",denngay:"",hoten:""}});t.useEffect(()=>{(async()=>{try{let a=await ae.fetchYearMonth(),l=await J.getChidoanOfUser();C([{label:"Tất cả",value:""}].concat(l.data.map(o=>({value:o._id,label:o.tenchidoan})))),b("tungay",a.data.year+"-01-01"),b("denngay",a.data.year+"-"+a.data.month+"-15"),p(a.data.year);let n=[];for(let o=a.data.year;o>=2020;o--)n.push({label:o,value:o});H(n),h(a.data.year+"-01-01"),x(a.data.year+"-"+a.data.month+"-15")}catch(a){console.log(a.message)}})()},[]);const X=async s=>{let a={...s,chidoans:s.chidoans.value};try{m(!0),h(c("tungay")),x(c("denngay"));let l=await N.getThiduathangs(a);B(l.data.tongsocanbo),L(l.data.data_not_red),k(l.data.total_blue),E(l.data.total_yellow),Y(s.chidoans),z(l.data.data_not_red.map((n,o)=>({stt:o+1,hoten:n.hoten,blue:n.blue,yellow:n.yellow}))),$(!0)}catch(l){console.log(l.message)}};return t.useEffect(()=>{i!==0&&(async()=>{m(!0);try{let a=await N.getBangThiduathangs({year:i,chidoans:r.value}),l=a.data.filter(n=>n.hoten.toLowerCase().includes(d.toLowerCase()));P(a.data),g(l),m(!1)}catch(a){console.log(a.message)}})()},[i,r]),t.useEffect(()=>{let s=[...O];if(s.length>0){const a=setTimeout(()=>{let l=s.filter(n=>n.hoten.toLowerCase().includes(d.toLowerCase()));g(l)},500);return()=>clearTimeout(a)}},[d]),e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(I,{color:"primary",fontSize:"large"}),e.jsxs("h4",{className:"font-bold text-gray-800 text-lg",children:["Theo dõi, thống kê thi đua tháng từ ngày ",j(S).format("DD/MM/YYYY")," đến ngày ",j(T).format("DD/MM/YYYY")," - chi đoàn, liên chi đoàn: ",r==null?void 0:r.label]})]}),e.jsx("form",{onSubmit:q(X),children:e.jsxs("div",{className:"flex flex-col mt-4 px-4 md:flex-row md:flex-wrap justify-end items-start",children:[e.jsxs("div",{className:"flex-col md:basis-1/3 flex flex-1 px-1 w-full",children:[e.jsx("label",{className:"underline font-semibold",children:"Họ tên: "}),e.jsx("input",{...u("hoten"),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                    focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col md:basis-1/6 flex flex-1 px-1 w-full",children:[e.jsx("label",{className:"underline font-semibold",children:"Từ ngày: "}),e.jsx("input",{...u("tungay"),type:"date",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col md:basis-1/6 flex flex-1 px-1 w-full",children:[e.jsx("label",{className:"underline font-semibold",children:"Đến ngày: "}),e.jsx("input",{...u("denngay"),type:"date",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col md:basis-1/6 flex flex-1 px-1 w-full",children:[e.jsx("label",{className:"underline font-semibold",children:"Chi đoàn, liên chi đoàn: "}),e.jsx(Q,{control:U,name:"chidoans",render:({field:s})=>e.jsx(y,{options:w,className:"basic-multi-select my-4 p-1",classNamePrefix:"select",placeholder:"Tất cả",...s})})]}),e.jsx("div",{className:"flex-col flex md:basis-1/6 px-1",children:e.jsxs(v,{size:"small",type:"submit",sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(ee,{})," Lấy dữ liệu"]})})]})}),M&&e.jsxs("div",{className:"px-4","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("h3",{className:"font-bold",children:["Phần mềm phát hiện ",f.length," đoàn viên xếp loại thi đua tháng cờ xanh hoặc vàng với tổng số lượt: "]}),e.jsxs("div",{className:"pl-8 mb-8",children:[e.jsxs("div",{className:"font-arial",children:[" - Cờ xanh: ",_," lượt"]}),e.jsxs("div",{className:"font-arial",children:[" - Cờ vàng: ",D," lượt"]})]}),e.jsx(v,{color:"info",variant:"contained",size:"small",children:e.jsx(W,{data:F,headers:le,filename:`canhancoxanh_vang_${c("tungay")}_${c("denngay")}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{}),e.jsx("span",{className:"text-sm",children:"Xuất file excel"})]})})}),e.jsx("div",{className:"mt-4",children:e.jsx(te,{list:f})})]}),e.jsxs("div",{className:"px-4",children:[e.jsxs("h3",{className:"text-center mt-4 font-mono text-xl font-bold",children:["Bảng theo dõi thi đua năm ",i," - ",r==null?void 0:r.label]}),e.jsxs("div",{className:"flex space-x-2 md:flex-row justify-end items-center",children:[e.jsxs("div",{className:"flex-col md:basis-1/3 flex  px-1",children:[e.jsx("label",{className:"underline font-semibold",children:"Họ tên: "}),e.jsx("input",{value:d,name:"search",onChange:s=>R(s.target.value),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                    focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsx("label",{className:"underline font-semibold",children:"Tùy chỉnh năm để lấy dữ liệu:"}),e.jsx(y,{value:{label:i,value:i},required:!0,name:"nam",options:A,className:"basic-multi-select my-4",classNamePrefix:"select",onChange:s=>p(s.value)})]})]}),e.jsx("div",{children:e.jsx(se,{list:V})})]})]})};export{_e as default};
