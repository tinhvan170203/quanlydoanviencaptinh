import{r as h,d as V,j as e,k as ae,m as te,u as ne,Q as y}from"./index-2b00a054.js";import{d as le}from"./GridView-85d728d6.js";import"./index.esm-a80e06b2.js";import{u as F,C as w}from"./index.esm-322da860.js";import{d as A}from"./Add-84462153.js";import{d as oe}from"./Close-7c89c175.js";import{q as ie}from"./base-e8aaf39e.js";import{d as $}from"./Search-c2bf7f37.js";import{f as re,g as ce,S as de,D as he,a as ue,h as me,d as xe,b as fe,c as pe,e as ge}from"./DialogDelete-f919c647.js";import{d as be}from"./donviApi-468d849b.js";import{S as H}from"./react-select.esm-a86401bf.js";import{c as D}from"./chidoanApi-461c2452.js";import{c as _,d as m,e as T,f as je,P as ve,h as Ce,i as ye,j as Ne,k as ke,u as Se,a as W,I as N,l as q,m as z,n as E,o as M}from"./LastPage-e02fc572.js";import{B as v}from"./Button-c283a03a.js";import{S as L}from"./Switch-39e410f5.js";import{s as Pe}from"./ButtonBase-ca61bcf9.js";import"./createSvgIcon-46c59fe3.js";const De=({row:o,page:t,rowsPerPage:c,index:n,onClickOpenDialogEdit:x,onClickOpenDialogDelete:l})=>{h.useState(null);const f=V(i=>i.authReducer.roles_quanlydoanvien);return e.jsxs(_,{className:"hover:bg-slate-200 transition duration-300",children:[e.jsx(m,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:t*c+n}),e.jsx(m,{className:"border-r border-slate-300",align:"left",children:o.tenchidoan}),e.jsx(m,{className:"border-r border-slate-300",align:"left",children:o.nhomdonvithuocchidoan.map(i=>e.jsxs("span",{children:[i.tendonvi," ,"]},i._id))}),e.jsx(m,{className:"border-r border-slate-300",align:"left",children:o.thutu}),e.jsx(m,{className:"border-r border-slate-300",align:"left",children:o.status===!0?e.jsx(v,{color:"success",children:"Active"}):e.jsx(v,{color:"warning",children:"NonActive"})}),e.jsxs(m,{align:"right",className:"bg-gray-300 flex justify-center items-center space-x-1 hover:bg-slate-500 transition duration-300",style:{width:"180px"},children:[f&&f.includes("sửa mô hình tổ chức")&&e.jsx(v,{variant:"contained",color:"info",size:"small",onClick:()=>x(o),children:e.jsx(re,{style:{fontSize:"20px"}})}),f&&f.includes("xóa mô hình tổ chức")&&e.jsx(v,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>l(o._id),children:e.jsx(ce,{style:{fontSize:"20px"}})})]})]},o._id)};function I(o){const t=Se(),{count:c,page:n,rowsPerPage:x,onPageChange:l}=o,f=a=>{l(a,0)},i=a=>{l(a,n-1)},k=a=>{l(a,n+1)},d=a=>{l(a,Math.max(0,Math.ceil(c/x)-1))};return e.jsxs(W,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(N,{onClick:f,disabled:n===0,"aria-label":"first page",children:t.direction==="rtl"?e.jsx(q,{}):e.jsx(z,{})}),e.jsx(N,{onClick:i,disabled:n===0,"aria-label":"previous page",children:t.direction==="rtl"?e.jsx(E,{}):e.jsx(M,{})}),e.jsx(N,{onClick:k,disabled:n>=Math.ceil(c/x)-1,"aria-label":"next page",children:t.direction==="rtl"?e.jsx(M,{}):e.jsx(E,{})}),e.jsx(N,{onClick:d,disabled:n>=Math.ceil(c/x)-1,"aria-label":"last page",children:t.direction==="rtl"?e.jsx(z,{}):e.jsx(q,{})})]})}I.propTypes={count:T.number.isRequired,onPageChange:T.func.isRequired,page:T.number.isRequired,rowsPerPage:T.number.isRequired};function Te({list:o,onClickOpenDialogEdit:t,onClickOpenDialogDelete:c}){const[n,x]=h.useState(0),[l,f]=h.useState(10),i=n>0?Math.max(0,(1+n)*l-o.length):0,k=(a,j)=>{x(j)},d=a=>{f(parseInt(a.target.value,10)),x(0)};return e.jsxs(e.Fragment,{children:[e.jsx(je,{component:ve,children:e.jsxs(Ce,{"aria-label":"custom pagination table",children:[e.jsx(ye,{children:e.jsxs(_,{children:[e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"#"}),e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"Tên chi, liên đoàn"}),e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Đơn vị thuộc chi, liên đoàn"}),e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Thứ tự"}),e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"200px",backgroundColor:"rgb(30, 41, 59 )"},children:"Trạng thái"}),e.jsx(m,{align:"center",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )",maxWidth:"150px"},children:"Thao tác"})]})}),e.jsxs(Ne,{children:[(l>0?o.slice(n*l,n*l+l):o).map((a,j)=>e.jsx(De,{row:a,page:n,rowsPerPage:l,index:j+1,onClickOpenDialogEdit:t,onClickOpenDialogDelete:c},a._id)),i>0&&e.jsx(_,{style:{height:53*i},children:e.jsx(m,{colSpan:6})})]})]})}),e.jsx("div",{children:e.jsx(ke,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:o.length,rowsPerPage:l,page:n,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:k,onRowsPerPageChange:d,ActionsComponent:I,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:j,to:g,count:r}){return`hiển thị ${j} đến ${g} bản ghi trong tổng số ${r!==-1?r:`more than ${g}`} bản ghi`}})})]})}const we=h.forwardRef(function(t,c){return e.jsx(de,{direction:"up",ref:c,...t})}),_e=Pe(N)({position:"absolute",right:"16px",top:"4px"});function Oe({open:o,item:t,onCloseDialogEdit:c,onSubmit:n,donvis:x}){const{register:l,handleSubmit:f,control:i,resetField:k,watch:d,setValue:a,formState:{errors:j}}=F({defaultValues:{tenchidoan:"",nhomdonvithuocchidoan:"",thutu:1,status:!0}});h.useEffect(()=>{t&&(a("tenchidoan",t.tenchidoan,{shouldValidate:!0}),a("thutu",t.thutu,{shouldValidate:!0}),a("status",t.status,{shouldValidate:!0}),a("nhomdonvithuocchidoan",t.nhomdonvithuocchidoan.map(r=>({value:r._id,label:r.tendonvi})),{shouldValidate:!0}))},[t]);const g=async r=>{if(n){const b={...r,id_edit:t._id};await n(b),c()}};return e.jsx(e.Fragment,{children:e.jsxs(he,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(r,b)=>{b!=="backdropClick"&&c(r,b)},open:o,TransitionComponent:we,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[e.jsxs(ue,{style:{display:"flex",borderBottom:"1px solid #ccc",backgroundColor:"rgb(30, 41, 59 )",margin:"0px"},children:[e.jsx(me,{style:{color:"white",fontSize:"24px",marginRight:"8px"}}),e.jsx("span",{className:"text-white text-[18px]",children:"Chỉnh sửa chi đoàn, liên chi đoàn"}),e.jsx(_e,{onClick:()=>c(),children:e.jsx(xe,{style:{color:"white"}})})]}),e.jsx(fe,{children:e.jsx(W,{children:e.jsxs("form",{className:"mt-2 mx-8",onSubmit:f(g),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên chi đoàn, liên chi đoàn: "]}),e.jsx("input",{...l("tenchidoan",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự: "]}),e.jsx("input",{...l("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái sử dụng:"}),e.jsx(w,{name:"status",control:i,render:({field:{value:r,onChange:b}})=>e.jsx(L,{checked:r,onChange:b})})]})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Các đơn vị thuộc chi đoàn, liên chi đoàn: "]}),e.jsx(w,{control:i,name:"nhomdonvithuocchidoan",render:({field:r})=>e.jsx(H,{isMulti:!0,required:!0,name:"nhomdonvithuocchidoan",options:x,className:"basic-multi-select my-4",classNamePrefix:"select",placeholder:"Vui lòng chọn đơn vị",...r})})]}),e.jsx(pe,{children:e.jsxs(v,{color:"primary",variant:"contained",type:"submit",style:{margin:"4px auto"},children:[e.jsx(A,{}),e.jsx("span",{children:"Cập nhật"})]})})]})})})]})})}const Xe=()=>{let[o,t]=ae();const[c,n]=h.useState([]),[x,l]=h.useState(!1),[f,i]=h.useState([]),[k,d]=te();ne();const[a,j]=h.useState(""),g=h.useMemo(()=>{const s=ie.parse(location.search);return{...s,tenchidoan:s.tenchidoan||""}},[location.search]),[r,b]=h.useState({status:!1,item:null}),Q=()=>{b({...r,status:!1})},K=s=>{s.preventDefault(),t({...g,tenchidoan:a})},G=s=>{b({item:s,status:!0})},[C,S]=h.useState({status:!1,id_Delete:null}),J=s=>{S({status:!0,id_Delete:s})},U=()=>{S({...C,status:!1})},X=()=>{S({...C,status:!1})},{register:O,handleSubmit:Y,control:B,resetField:P,watch:Be,formState:{errors:Re}}=F({defaultValues:{tenchidoan:"",nhomdonvithuocchidoan:"",thutu:1,status:!0}});h.useEffect(()=>{(async()=>{try{let u=await be.getDonvis();n(u.data.map(p=>({value:p._id,label:p.tendonvi})))}catch(u){console.log(u.message)}})()},[]),h.useEffect(()=>{(async()=>{try{d(!0);let u=await D.getChidoans(g);i(u.data),setTimeout(()=>{d(!1)},400)}catch(u){console.log(u.message)}})()},[g]);const Z=async s=>{let u={...s,queryParams:g};d(!0);try{let p=await D.addChidoan(u);i(p.data.chidoans),setTimeout(()=>{d(!1)},400),P("tenchidoan"),P("thutu"),P("nhomdonvithuocchidoan"),P("status"),y.success(p.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(p){y.error(p.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),d(!1)}},ee=async s=>{let u={...s,queryParams:g};d(!0);try{let p=await D.editChidoan(u);i(p.data.chidoans),setTimeout(()=>{d(!1)},400),y.success(p.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(p){y.error(p.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),d(!1)}},se=async()=>{d(!0);try{let s=await D.deleteChidoan(C.id_Delete,{...g});i(s.data.chidoans),setTimeout(()=>{d(!1)},400),S({...C,status:!1}),y.success(s.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(s){S({...C,status:!1}),y.error(s.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),d(!1)}},R=V(s=>s.authReducer.roles_quanlydoanvien);return e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(le,{color:"primary",fontSize:"large"}),e.jsx("h4",{className:"font-bold text-gray-800 text-lg",children:"Quản lý chi đoàn, liên chi đoàn"})]}),R&&R.includes("thêm mô hình tổ chức")&&e.jsxs("form",{className:"mt-2 mx-8",onSubmit:Y(Z),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên chi đoàn, liên chi đoàn: "]}),e.jsx("input",{...O("tenchidoan",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự: "]}),e.jsx("input",{...O("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái sử dụng:"}),e.jsx(w,{name:"status",control:B,render:({field:{value:s,onChange:u}})=>e.jsx(L,{checked:s,onChange:u})})]})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Các đơn vị thuộc chi đoàn, liên chi đoàn: "]}),e.jsx(w,{control:B,name:"nhomdonvithuocchidoan",render:({field:s})=>e.jsx(H,{isMulti:!0,required:!0,name:"nhomdonvithuocchidoan",options:c,className:"basic-multi-select my-4",classNamePrefix:"select",placeholder:"Vui lòng chọn đơn vị",...s})})]}),e.jsxs("div",{className:"md:space-x-2 space-y-2 md:space-y-0 md:block flex flex-col items-center",children:[e.jsxs(v,{type:"submit",sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(A,{})," Thêm mới"]}),e.jsxs(v,{sx:{width:"220px",backgroundColor:"darkgray"},onClick:()=>l(!0),color:"info",variant:"contained",children:[e.jsx($,{})," Chức năng tìm kiếm"]})]})]}),x&&e.jsxs("form",{onSubmit:s=>K(s),className:"my-2 mt-4 mx-8 bg-slate-800 p-4 rounded-lg shadow-xl","data-aos":"zoom-in-down","data-aos-once":"true",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h5",{className:"text-white text-[18px] font-semibold",children:"Tìm kiếm chi đoàn, liên chi đoàn"}),e.jsx(N,{onClick:()=>l(!1),sx:{backgroundColor:"#ccc"},children:e.jsx(oe,{sx:{color:"white"}})})]}),e.jsx("div",{className:"flex space-x-4 mt-4",children:e.jsx("div",{className:"flex-col flex flex-1",children:e.jsx("input",{type:"text",defaultValue:a,className:`outline-none my-2 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:ring-white focus:border-white`,onChange:s=>j(s.target.value),placeholder:"Tên chi đoàn, liên chi đoàn"})})}),e.jsx("div",{className:"my-2 text-center",children:e.jsxs(v,{sx:{width:"200px",backgroundColor:"slategray"},type:"submit",color:"info",variant:"contained",children:[e.jsx($,{})," Tìm kiếm"]})})]}),e.jsx("div",{className:"mt-6 mx-8",children:e.jsx(Te,{list:f,onClickOpenDialogDelete:J,onClickOpenDialogEdit:G})}),e.jsx(Oe,{open:r.status,item:r.item,onCloseDialogEdit:Q,onSubmit:ee,donvis:c}),e.jsx(ge,{open:C.status,onCloseDialogDelete:X,onConfirmDelete:se,onCancelDelete:U})]})};export{Xe as default};
