import{r as p,d as A,j as e,u as Y,m as Z,f as S,Q as v}from"./index-2b00a054.js";import{d as ee}from"./GridView-85d728d6.js";import"./index.esm-a80e06b2.js";import{u as E,C as k}from"./index.esm-322da860.js";import{d as F}from"./Add-84462153.js";import{S as C}from"./react-select.esm-a86401bf.js";import{r as se}from"./roleApi-b4c7a90e.js";import{c as B,d as h,e as q,f as ae,P as te,h as le,i as ne,j as re,k as oe,u as ie,a as H,I as D,l as M,m as $,n as z,o as V}from"./LastPage-e02fc572.js";import{f as de,g as ce,S as ue,D as he,a as me,h as xe,d as pe,b as fe,c as ge,e as be}from"./DialogDelete-f919c647.js";import{B as _}from"./Button-c283a03a.js";import{s as je}from"./ButtonBase-ca61bcf9.js";import{d as ye}from"./donviApi-468d849b.js";import{c as Ne}from"./chidoanApi-461c2452.js";import"./createSvgIcon-46c59fe3.js";const ve=({row:l,page:a,rowsPerPage:c,index:n,onClickOpenDialogEdit:m,onClickOpenDialogDelete:i})=>{p.useState(null);const x=A(r=>r.authReducer.roles_quanlydoanvien);return e.jsxs(B,{className:"hover:bg-slate-200 transition duration-300",children:[e.jsx(h,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:a*c+n}),e.jsx(h,{className:"border-r border-slate-300",align:"left",children:l.tentaikhoan}),e.jsx(h,{className:"border-r border-slate-300",align:"left",children:l.matkhau}),e.jsx(h,{className:"border-r border-slate-300",align:"left",children:l.roles.map(r=>e.jsxs("span",{children:[r.tennhom,", "]},r._id))}),e.jsx(h,{className:"border-r border-slate-300",align:"left",children:l.quantrinhomdonvi.map(r=>e.jsxs("span",{children:[r.tendonvi,", "]},r._id))}),e.jsx(h,{className:"border-r border-slate-300",align:"left",children:l.quantrinhomchidoan.map(r=>e.jsxs("span",{children:[r.tenchidoan,", "]},r._id))}),e.jsxs(h,{align:"right",className:"bg-gray-300 flex justify-center items-center space-x-1 hover:bg-slate-500 transition duration-300",style:{width:"180px"},children:[x&&x.includes("sửa tài khoản")&&e.jsx(_,{variant:"contained",color:"info",size:"small",onClick:()=>m(l),children:e.jsx(de,{style:{fontSize:"20px"}})}),x&&x.includes("xóa tài khoản")&&e.jsx(_,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>i(l._id),children:e.jsx(ce,{style:{fontSize:"20px"}})})]})]},l._id)};function W(l){const a=ie(),{count:c,page:n,rowsPerPage:m,onPageChange:i}=l,x=d=>{i(d,0)},r=d=>{i(d,n-1)},y=d=>{i(d,n+1)},o=d=>{i(d,Math.max(0,Math.ceil(c/m)-1))};return e.jsxs(H,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(D,{onClick:x,disabled:n===0,"aria-label":"first page",children:a.direction==="rtl"?e.jsx(M,{}):e.jsx($,{})}),e.jsx(D,{onClick:r,disabled:n===0,"aria-label":"previous page",children:a.direction==="rtl"?e.jsx(z,{}):e.jsx(V,{})}),e.jsx(D,{onClick:y,disabled:n>=Math.ceil(c/m)-1,"aria-label":"next page",children:a.direction==="rtl"?e.jsx(V,{}):e.jsx(z,{})}),e.jsx(D,{onClick:o,disabled:n>=Math.ceil(c/m)-1,"aria-label":"last page",children:a.direction==="rtl"?e.jsx($,{}):e.jsx(M,{})})]})}W.propTypes={count:q.number.isRequired,onPageChange:q.func.isRequired,page:q.number.isRequired,rowsPerPage:q.number.isRequired};function ke({list:l,onClickOpenDialogEdit:a,onClickOpenDialogDelete:c}){const[n,m]=p.useState(0),[i,x]=p.useState(10),r=n>0?Math.max(0,(1+n)*i-l.length):0,y=(d,u)=>{m(u)},o=d=>{x(parseInt(d.target.value,10)),m(0)};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{component:te,children:e.jsxs(le,{"aria-label":"custom pagination table",children:[e.jsx(ne,{children:e.jsxs(B,{children:[e.jsx(h,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"#"}),e.jsx(h,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"Tên tài khoản"}),e.jsx(h,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"mật khẩu"}),e.jsx(h,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Nhóm quyền hệ thống"}),e.jsx(h,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Quản trị nhóm đơn vị"}),e.jsx(h,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Quản trị nhóm chi đoàn"}),e.jsx(h,{align:"center",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )",maxWidth:"150px"},children:"Thao tác"})]})}),e.jsxs(re,{children:[(i>0?l.slice(n*i,n*i+i):l).map((d,u)=>e.jsx(ve,{row:d,page:n,rowsPerPage:i,index:u+1,onClickOpenDialogEdit:a,onClickOpenDialogDelete:c},d._id)),r>0&&e.jsx(B,{style:{height:53*r},children:e.jsx(h,{colSpan:6})})]})]})}),e.jsx("div",{children:e.jsx(oe,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:l.length,rowsPerPage:i,page:n,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:y,onRowsPerPageChange:o,ActionsComponent:W,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:u,to:N,count:P}){return`hiển thị ${u} đến ${N} bản ghi trong tổng số ${P!==-1?P:`more than ${N}`} bản ghi`}})})]})}const Ce=p.forwardRef(function(a,c){return e.jsx(ue,{direction:"up",ref:c,...a})}),Pe=je(D)({position:"absolute",right:"16px",top:"4px"});function De({open:l,item:a,onCloseDialogEdit:c,onSubmit:n,roles:m,donvis:i,chidoans:x}){const{register:r,handleSubmit:y,control:o,resetField:d,setValue:u,watch:N,formState:{errors:P}}=E({defaultValues:{tentaikhoan:"",matkhau:"",roles:"",quantrinhomchidoan:"",quantrinhomdonvi:""}});p.useEffect(()=>{a&&(u("tentaikhoan",a.tentaikhoan,{shouldValidate:!0}),u("matkhau",a.matkhau,{shouldValidate:!0}),u("roles",a.roles.map(s=>({value:s._id,label:s.tennhom})),{shouldValidate:!0}),u("quantrinhomdonvi",a.quantrinhomdonvi.map(s=>({value:s._id,label:s.tendonvi})),{shouldValidate:!0}),u("quantrinhomchidoan",a.quantrinhomchidoan.map(s=>({value:s._id,label:s.tenchidoan})),{shouldValidate:!0}))},[a]);const T=async s=>{if(n){const b={...s,id_edit:a._id};await n(b),c()}};return e.jsx(e.Fragment,{children:e.jsxs(he,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(s,b)=>{b!=="backdropClick"&&c(s,b)},open:l,TransitionComponent:Ce,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[e.jsxs(me,{style:{display:"flex",borderBottom:"1px solid #ccc",backgroundColor:"rgb(30, 41, 59 )",margin:"0px"},children:[e.jsx(xe,{style:{color:"white",fontSize:"24px",marginRight:"8px"}}),e.jsx("span",{className:"text-white text-[18px]",children:"Chỉnh sửa tài khoản người dùng"}),e.jsx(Pe,{onClick:()=>c(),children:e.jsx(pe,{style:{color:"white"}})})]}),e.jsx(fe,{children:e.jsx(H,{children:e.jsxs("form",{className:"mt-2 mx-8",onSubmit:y(T),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên tài khoản: "]}),e.jsx("input",{...r("tentaikhoan",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Mật khẩu: "]}),e.jsx("input",{...r("matkhau",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Nhóm quyền: "]}),e.jsx(k,{control:o,name:"roles",render:({field:s})=>e.jsx(C,{isMulti:!0,options:m,className:"basic-multi-select my-4",classNamePrefix:"select",...s,required:!0})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Quản trị nhóm đơn vị: "]}),e.jsx(k,{control:o,name:"quantrinhomdonvi",render:({field:s})=>e.jsx(C,{isMulti:!0,options:i,className:"basic-multi-select my-4",classNamePrefix:"select",...s,required:!0})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Quản trị nhóm chi đoàn: "]}),e.jsx(k,{control:o,name:"quantrinhomchidoan",render:({field:s})=>e.jsx(C,{required:!0,isMulti:!0,options:x,className:"basic-multi-select my-4",classNamePrefix:"select",...s})})]}),e.jsx(ge,{children:e.jsxs(_,{color:"primary",variant:"contained",type:"submit",style:{margin:"4px auto"},children:[e.jsx(F,{}),e.jsx("span",{children:"Cập nhật"})]})})]})})})]})})}const We=()=>{const[l,a]=p.useState([]),[c,n]=p.useState([]),[m,i]=p.useState([]),[x,r]=p.useState([]);Y();const[y,o]=Z(),d=A(t=>t.authReducer.roles_quanlydoanvien),[u,N]=p.useState({status:!1,item:null}),P=()=>{N({...u,status:!1})},T=t=>{N({item:t,status:!0})},[s,b]=p.useState({status:!1,id_Delete:null}),Q=t=>{b({status:!0,id_Delete:t})},L=()=>{b({...s,status:!1})},U=()=>{b({...s,status:!1})},{register:R,handleSubmit:I,control:w,resetField:O,watch:Se,formState:{errors:qe}}=E({defaultValues:{tentaikhoan:"",matkhau:"",roles:"",quantrinhomdonvi:"",quantrinhomchidoan:""}});p.useEffect(()=>{(async()=>{try{let f=await se.getRoles(),g=await ye.getDonvis(),X=await Ne.getChidoans({tenchidoan:""});n(f.data.map(j=>({value:j._id,label:j.tennhom}))),i(g.data.map(j=>({label:j.tendonvi,value:j._id}))),r(X.data.map(j=>({label:j.tenchidoan,value:j._id})))}catch(f){console.log(f.message)}})()},[]),p.useEffect(()=>{(async()=>{o(!0);try{let f=await S.getUsers();a(f.data),setTimeout(()=>{o(!1)},400)}catch(f){console.log(f.message)}})()},[]);const K=async t=>{let f={...t};o(!0);try{let g=await S.addUser(f);a(g.data.users),setTimeout(()=>{o(!1)},400),O("tentaikhoan"),O("matkhau"),O("roles"),v.success(g.data.message,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(g){v.error(g.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),o(!1)}},G=async t=>{let f={...t};o(!0);try{let g=await S.editUser(f);a(g.data.users),setTimeout(()=>{o(!1)},400),v.success(g.data.message,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(g){v.error(g.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),o(!1)}},J=async()=>{o(!0);try{let t=await S.deleteUser(s.id_Delete);a(t.data.users),setTimeout(()=>{o(!1)},400),b({...s,status:!1}),v.success(t.data.message,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(t){b({...s,status:!1}),v.error(t.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),o(!1)}};return e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ee,{color:"primary",fontSize:"large"}),e.jsx("h4",{className:"font-bold text-gray-800 text-lg",children:"Quản lý tài khoản hệ thống"})]}),d&&d.includes("thêm tài khoản")&&e.jsxs("form",{className:"mt-2 mx-8",onSubmit:I(K),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên tài khoản: "]}),e.jsx("input",{...R("tentaikhoan",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`,placeholder:"Vui lòng nhập tên tài khoản"})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Mật khẩu: "]}),e.jsx("input",{...R("matkhau",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`,placeholder:"Vui lòng nhập mật khẩu"})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Nhóm quyền: "]}),e.jsx(k,{control:w,name:"roles",render:({field:t})=>e.jsx(C,{required:!0,isMulti:!0,options:c,className:"basic-multi-select my-4",classNamePrefix:"select",...t,placeholder:"Vui lòng chọn nhóm quyền hệ thống"})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Phân quyền quản lý các đơn vị: "]}),e.jsx(k,{control:w,name:"quantrinhomdonvi",render:({field:t})=>e.jsx(C,{required:!0,isMulti:!0,options:m,className:"basic-multi-select my-4",classNamePrefix:"select",...t,placeholder:"Vui lòng chọn đơn vị"})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Phân quyền quản lý các chi đoàn: "]}),e.jsx(k,{control:w,name:"quantrinhomchidoan",render:({field:t})=>e.jsx(C,{required:!0,placeholder:"Vui lòng chọn chi đoàn",isMulti:!0,options:x,className:"basic-multi-select my-4",classNamePrefix:"select",...t})})]}),e.jsx("div",{className:"md:space-x-2 space-y-2 md:space-y-0 md:block flex flex-col items-center",children:e.jsxs(_,{type:"submit",sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(F,{})," Thêm mới"]})})]}),e.jsx("div",{className:"mt-6 mx-8",children:e.jsx(ke,{list:l,onClickOpenDialogDelete:Q,onClickOpenDialogEdit:T})}),e.jsx(De,{open:u.status,item:u.item,onCloseDialogEdit:P,onSubmit:G,roles:c,donvis:m,chidoans:x}),e.jsx(be,{open:s.status,onCloseDialogDelete:U,onConfirmDelete:J,onCancelDelete:L})]})};export{We as default};
