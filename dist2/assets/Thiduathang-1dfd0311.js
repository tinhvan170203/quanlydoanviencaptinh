import{r as o,j as e,m as Q,d as V,Q as G}from"./index-2b00a054.js";import{d as X}from"./GridView-85d728d6.js";import"./index.esm-a80e06b2.js";import{d as D}from"./Add-84462153.js";import{S as W}from"./react-select.esm-a86401bf.js";import{c as w}from"./canboApi-c8a721f9.js";import{c as R,d as c,e as T,f as J,P as K,h as U,i as Z,j as ee,k as ae,u as te,a as le,I as k,l as $,m as I,n as M,o as q}from"./LastPage-e02fc572.js";import"./dayjs.min-51d44ca9.js";import{B as z}from"./Button-c283a03a.js";import"./createSvgIcon-46c59fe3.js";import"./ButtonBase-ca61bcf9.js";const ne=({row:t,page:h,rowsPerPage:p,index:u,onHandleChangeItem:d,onHandleChangeText:x})=>{o.useState(null);const[r,f]=o.useState("null"),[m,b]=o.useState("");o.useEffect(()=>{t&&(f(t.thiduathang.result),b(t.thiduathang.ghichu))},[t]);const n=g=>{f(g.target.value),d(t,g.target.value)},j=g=>{b(g.target.value),x(t,g.target.value)};return e.jsxs(R,{children:[e.jsx(c,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:h*p+u}),e.jsx(c,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:t.hoten}),e.jsx(c,{className:"border-r border-slate-300",align:"left",children:t.bachamPopulate[0].bacham}),e.jsx(c,{className:"border-r border-slate-300",align:"left",children:e.jsx("p",{className:"truncate",children:t.donviPopulate[0].tendonvi})}),e.jsx(c,{className:"border-r border-slate-300",align:"left",children:e.jsxs("select",{className:"outline-none p-2 w-full",onChange:g=>n(g),value:r,children:[e.jsx("option",{value:"null",children:"Chưa phân loại"}),e.jsx("option",{value:"red",children:"Cờ đỏ"}),e.jsx("option",{value:"blue",children:"Cờ xanh"}),e.jsx("option",{value:"yellow",children:"Cờ vàng"})]})}),e.jsx(c,{className:"border-r border-slate-300",align:"left",children:e.jsx("input",{type:"text",className:"w-full border p-2 rounded-md",value:m,onChange:g=>j(g)})})]},t._id)};function L(t){const h=te(),{count:p,page:u,rowsPerPage:d,onPageChange:x}=t,r=n=>{x(n,0)},f=n=>{x(n,u-1)},m=n=>{x(n,u+1)},b=n=>{x(n,Math.max(0,Math.ceil(p/d)-1))};return e.jsxs(le,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(k,{onClick:r,disabled:u===0,"aria-label":"first page",children:h.direction==="rtl"?e.jsx($,{}):e.jsx(I,{})}),e.jsx(k,{onClick:f,disabled:u===0,"aria-label":"previous page",children:h.direction==="rtl"?e.jsx(M,{}):e.jsx(q,{})}),e.jsx(k,{onClick:m,disabled:u>=Math.ceil(p/d)-1,"aria-label":"next page",children:h.direction==="rtl"?e.jsx(q,{}):e.jsx(M,{})}),e.jsx(k,{onClick:b,disabled:u>=Math.ceil(p/d)-1,"aria-label":"last page",children:h.direction==="rtl"?e.jsx(I,{}):e.jsx($,{})})]})}L.propTypes={count:T.number.isRequired,onPageChange:T.func.isRequired,page:T.number.isRequired,rowsPerPage:T.number.isRequired};function se({list:t,onHandleChangeAll:h,onHandleChangeItem:p,onHandleChangeText:u}){const[d,x]=o.useState(0),[r,f]=o.useState(10);d>0&&Math.max(0,(1+d)*r-t.length);const m=(n,j)=>{x(j)},b=n=>{f(parseInt(n.target.value,10)),x(0)};return e.jsxs(e.Fragment,{children:[e.jsx(J,{component:K,style:{overflowX:"scroll"},children:e.jsxs(U,{"aria-label":"custom pagination table",children:[e.jsxs(Z,{children:[e.jsxs(R,{children:[e.jsx(c,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"#"}),e.jsx(c,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )",minWidth:"250px"},children:"Họ tên"}),e.jsx(c,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )",minWidth:"120px"},children:"Bậc hàm"}),e.jsx(c,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )",minWidth:"300px"},children:"Đơn vị công tác"}),e.jsx(c,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )",minWidth:"120px"},children:"Phân loại"}),e.jsx(c,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )",minWidth:"300px"},children:"Ghi chú"})]}),e.jsxs(R,{children:[e.jsx(c,{colSpan:4,className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"}}),e.jsx(c,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:e.jsxs("select",{onChange:n=>h(n.target.value),className:"outline-none p-2 w-full",children:[e.jsx("option",{value:"null",children:"Chưa phân loại"}),e.jsx("option",{value:"red",children:"Cờ đỏ"}),e.jsx("option",{value:"blue",children:"Cờ xanh"}),e.jsx("option",{value:"yellow",children:"Cờ vàng"})]})}),e.jsx(c,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"}})]})]}),e.jsx(ee,{children:(r>0?t.slice(d*r,d*r+r):t).map((n,j)=>e.jsx(ne,{row:n,page:d,rowsPerPage:r,index:j+1,onHandleChangeItem:p,onHandleChangeText:u},n._id))})]})}),e.jsx("div",{children:e.jsx(ae,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:t.length,rowsPerPage:r,page:d,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:m,onRowsPerPageChange:b,ActionsComponent:L,labelRowsPerPage:"Số cán bộ hiển thị trên mỗi trang",labelDisplayedRows:function({from:j,to:g,count:C}){return`hiển thị ${j} đến ${g} cán bộ trong tổng số ${C!==-1?C:`more than ${g}`} cán bộ`}})})]})}const fe=()=>{const[t,h]=o.useState([]),[p,u]=o.useState(1),[d,x]=o.useState(1),[r,f]=o.useState(1),[m,b]=o.useState(2022),[n,j]=o.useState([]),[g,C]=Q(),[N,S]=o.useState([]),[_,Y]=o.useState("");o.useEffect(()=>{(async()=>{try{let l=await w.fetchYearMonth();f(l.data.month),u(l.data.month),b(l.data.year),x(l.data.year);let s=[];for(let i=l.data.year;i>=2020;i--)s.push({label:i,value:i});j(s)}catch(l){console.log(l.message)}})()},[]);const A=async()=>{try{C(!0);let a=await w.fetchThiduathang({month:r,year:m});S(a.data),h(a.data),u(r),x(m),C(!1)}catch(a){console.log(a.message)}};o.useEffect(()=>{const a=setTimeout(()=>{let s=[...t].filter(i=>i.hoten.toLowerCase().includes(_.toLowerCase()));S(s)},500);return()=>clearTimeout(a)},[_]);const H=a=>{let l=[...N];l=l.map(i=>({...i,thiduathang:{ghichu:i.thiduathang.ghichu,result:a}})),S(l);let s=[...t];for(let i of l){let v=s.findIndex(P=>P._id.toString()===i._id.toString());s[v].thiduathang.result=i.thiduathang.result}h(s)},E=(a,l)=>{let s=[...N],i=s.findIndex(y=>y._id.toString()===a._id.toString());s[i].thiduathang.result=l;let v=[...t],P=s.findIndex(y=>y._id.toString()===a._id.toString());v[P].thiduathang.result=l,h(v),S(s)},O=(a,l)=>{let s=[...N],i=s.findIndex(y=>y._id.toString()===a._id.toString());s[i].thiduathang.ghichu=l,S(s);let v=[...t],P=v.findIndex(y=>y._id.toString()===a._id.toString());v[P].thiduathang.ghichu=l,h(v)},F=async()=>{let a={doanviens:t,month:p,year:d};try{C(!0);let l=await w.updateThiduathang(a);G.success(l.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),C(!1)}catch(l){console.log(l.message)}},B=V(a=>a.authReducer.roles_quanlydoanvien);return e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(X,{color:"primary",fontSize:"large"}),e.jsxs("h4",{className:"font-bold text-gray-800 text-lg",children:["Quản lý thi đua tháng ",p," - ",d]})]}),e.jsxs("div",{className:"flex space-x-2 md:flex-row justify-end items-start",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/6",children:[e.jsx("label",{className:"underline font-semibold",children:"Tháng:"}),e.jsx(W,{value:{label:r,value:r},required:!0,name:"thang",options:[{label:1,value:1},{label:2,value:2},{label:3,value:3},{label:4,value:4},{label:5,value:5},{label:6,value:6},{label:7,value:7},{label:8,value:8},{label:9,value:9},{label:10,value:10},{label:11,value:11},{label:12,value:12}],className:"basic-multi-select my-4",classNamePrefix:"select",onChange:a=>f(a.value)})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/6",children:[e.jsx("label",{className:"underline font-semibold",children:"Năm:"}),e.jsx(W,{value:{label:m,value:m},required:!0,name:"nam",options:n,className:"basic-multi-select my-4",classNamePrefix:"select",onChange:a=>b(a.value)})]}),e.jsx("div",{className:"flex-col flex md:basis-1/6",children:e.jsxs(z,{onClick:()=>A(),sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(D,{})," Lấy dữ liệu"]})})]}),e.jsxs("div",{className:"mx-8 flex space-x-2 items-center",children:[e.jsx("input",{type:"text",defaultValue:_,onChange:a=>Y(a.target.value),placeholder:"Search họ tên",className:"p-2 border rounded-md"}),B&&B.includes("thêm thi đua")&&e.jsxs(z,{onClick:()=>F(),sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(D,{})," Lưu dữ liệu"]})]}),e.jsx("div",{className:"mt-6 mx-8",children:e.jsx(se,{list:N,onHandleChangeItem:E,onHandleChangeAll:H,onHandleChangeText:O})})]})};export{fe as default};
