import{n as T,r as d,d as L,j as e,k as oe,m as ie,u as de,Q as N}from"./index-2b00a054.js";import{d as ce}from"./GridView-85d728d6.js";import"./index.esm-a80e06b2.js";import{u as I,C as O}from"./index.esm-322da860.js";import{d as Q}from"./Add-84462153.js";import{d as ue}from"./Close-7c89c175.js";import{q as he}from"./base-e8aaf39e.js";import{d as V}from"./Search-c2bf7f37.js";import{f as xe,g as me,S as pe,D as ge,a as fe,h as be,d as je,b as ve,c as ye,e as Ce}from"./DialogDelete-f919c647.js";import{d as Ne}from"./donviApi-468d849b.js";import{S as $}from"./react-select.esm-a86401bf.js";import{c as R,d as x,e as w,f as De,P as Se,h as ke,i as Pe,j as Te,k as we,u as _e,a as K,I as D,l as F,m as A,n as H,o as W}from"./LastPage-e02fc572.js";import{B as j}from"./Button-c283a03a.js";import{S as G}from"./Switch-39e410f5.js";import{s as Oe}from"./ButtonBase-ca61bcf9.js";import"./createSvgIcon-46c59fe3.js";const _={getDois(a){const t="/doi/fetch";return T.get(t,{params:a})},addDoi(a){const t="/doi/add";return T.post(t,a)},editDoi(a){const t=`/doi/edit/${a.id_edit}`;return T.put(t,a)},deleteDoi(a,t){const o=`/doi/delete/${a}`;return T.delete(o,{params:t})}},Be=({row:a,page:t,rowsPerPage:o,index:n,onClickOpenDialogEdit:m,onClickOpenDialogDelete:l})=>{d.useState(null);const p=L(u=>u.authReducer.roles_quanlydoanvien);return e.jsxs(R,{className:"hover:bg-slate-200 transition duration-300",children:[e.jsx(x,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:t*o+n}),e.jsx(x,{className:"border-r border-slate-300",align:"left",children:a.tendoi}),e.jsx(x,{className:"border-r border-slate-300",align:"left",children:a.donvi.tendonvi}),e.jsx(x,{className:"border-r border-slate-300",align:"left",children:a.thutu}),e.jsx(x,{className:"border-r border-slate-300",align:"left",children:a.status===!0?e.jsx(j,{color:"success",children:"Active"}):e.jsx(j,{color:"warning",children:"NonActive"})}),e.jsxs(x,{align:"right",className:"bg-gray-300 flex justify-center items-center space-x-1 hover:bg-slate-500 transition duration-300",style:{width:"180px"},children:[p&&p.includes("sửa mô hình tổ chức")&&e.jsx(j,{variant:"contained",color:"info",size:"small",onClick:()=>m(a),children:e.jsx(xe,{style:{fontSize:"20px"}})}),p&&p.includes("xóa mô hình tổ chức")&&e.jsx(j,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>l(a._id),children:e.jsx(me,{style:{fontSize:"20px"}})})]})]},a._id)};function J(a){const t=_e(),{count:o,page:n,rowsPerPage:m,onPageChange:l}=a,p=i=>{l(i,0)},u=i=>{l(i,n-1)},S=i=>{l(i,n+1)},r=i=>{l(i,Math.max(0,Math.ceil(o/m)-1))};return e.jsxs(K,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(D,{onClick:p,disabled:n===0,"aria-label":"first page",children:t.direction==="rtl"?e.jsx(F,{}):e.jsx(A,{})}),e.jsx(D,{onClick:u,disabled:n===0,"aria-label":"previous page",children:t.direction==="rtl"?e.jsx(H,{}):e.jsx(W,{})}),e.jsx(D,{onClick:S,disabled:n>=Math.ceil(o/m)-1,"aria-label":"next page",children:t.direction==="rtl"?e.jsx(W,{}):e.jsx(H,{})}),e.jsx(D,{onClick:r,disabled:n>=Math.ceil(o/m)-1,"aria-label":"last page",children:t.direction==="rtl"?e.jsx(A,{}):e.jsx(F,{})})]})}J.propTypes={count:w.number.isRequired,onPageChange:w.func.isRequired,page:w.number.isRequired,rowsPerPage:w.number.isRequired};function $e({list:a,onClickOpenDialogEdit:t,onClickOpenDialogDelete:o}){const[n,m]=d.useState(0),[l,p]=d.useState(10),u=n>0?Math.max(0,(1+n)*l-a.length):0,S=(i,f)=>{m(f)},r=i=>{p(parseInt(i.target.value,10)),m(0)};return e.jsxs(e.Fragment,{children:[e.jsx(De,{component:Se,children:e.jsxs(ke,{"aria-label":"custom pagination table",children:[e.jsx(Pe,{children:e.jsxs(R,{children:[e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"#"}),e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"Tên đội, công an cấp xã"}),e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Đơn vị cấp trên"}),e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Thứ tự"}),e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"200px",backgroundColor:"rgb(30, 41, 59 )"},children:"Trạng thái"}),e.jsx(x,{align:"center",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )",maxWidth:"150px"},children:"Thao tác"})]})}),e.jsxs(Te,{children:[(l>0?a.slice(n*l,n*l+l):a).map((i,f)=>e.jsx(Be,{row:i,page:n,rowsPerPage:l,index:f+1,onClickOpenDialogEdit:t,onClickOpenDialogDelete:o},i._id)),u>0&&e.jsx(R,{style:{height:53*u},children:e.jsx(x,{colSpan:6})})]})]})}),e.jsx("div",{children:e.jsx(we,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:a.length,rowsPerPage:l,page:n,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:S,onRowsPerPageChange:r,ActionsComponent:J,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:f,to:v,count:g}){return`hiển thị ${f} đến ${v} bản ghi trong tổng số ${g!==-1?g:`more than ${v}`} bản ghi`}})})]})}const Re=d.forwardRef(function(t,o){return e.jsx(pe,{direction:"up",ref:o,...t})}),qe=Oe(D)({position:"absolute",right:"16px",top:"4px"});function ze({open:a,item:t,onCloseDialogEdit:o,onSubmit:n,donvis:m}){const{register:l,handleSubmit:p,control:u,resetField:S,setValue:r,watch:i,formState:{errors:f}}=I({defaultValues:{tendoi:"",donvi:"",thutu:1,status:!0}});d.useEffect(()=>{t&&(r("tendoi",t.tendoi,{shouldValidate:!0}),r("thutu",t.thutu,{shouldValidate:!0}),r("status",t.status,{shouldValidate:!0}),r("donvi",{label:t.donvi.tendonvi,value:t.donvi._id},{shouldValidate:!0}))},[t]);const v=async g=>{if(n){const b={...g,id_edit:t._id};await n(b),o()}};return e.jsx(e.Fragment,{children:e.jsxs(ge,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(g,b)=>{b!=="backdropClick"&&o(g,b)},open:a,TransitionComponent:Re,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[e.jsxs(fe,{style:{display:"flex",borderBottom:"1px solid #ccc",backgroundColor:"rgb(30, 41, 59 )",margin:"0px"},children:[e.jsx(be,{style:{color:"white",fontSize:"24px",marginRight:"8px"}}),e.jsx("span",{className:"text-white text-[18px]",children:"Chỉnh sửa đội nghiệp vụ, công an cấp xã"}),e.jsx(qe,{onClick:()=>o(),children:e.jsx(je,{style:{color:"white"}})})]}),e.jsx(ve,{children:e.jsx(K,{children:e.jsxs("form",{className:"mt-2 mx-8",onSubmit:p(v),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên đội nghiệp vụ, công an cấp xã: "]}),e.jsx("input",{...l("tendoi",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự: "]}),e.jsx("input",{...l("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái sử dụng:"}),e.jsx(O,{name:"status",control:u,render:({field:{value:g,onChange:b}})=>e.jsx(G,{checked:g,onChange:b})})]})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Đơn vị cấp trên: "]}),e.jsx(O,{control:u,name:"donvi",render:({field:g})=>e.jsx($,{required:!0,name:"donvi",options:m,className:"basic-multi-select my-4",classNamePrefix:"select",...g})})]}),e.jsx(ye,{children:e.jsxs(j,{color:"primary",variant:"contained",type:"submit",style:{margin:"4px auto"},children:[e.jsx(Q,{}),e.jsx("span",{children:"Cập nhật"})]})})]})})})]})})}const ss=()=>{let[a,t]=oe();const[o,n]=d.useState([]),[m,l]=d.useState(!1),[p,u]=d.useState([]),[S,r]=ie();de();const[i,f]=d.useState([]),[v,g]=d.useState(""),[b,U]=d.useState(""),y=d.useMemo(()=>{const s=he.parse(location.search);return{...s,tendoi:s.tendoi||"",donvi:s.donvi||""}},[location.search]),[B,q]=d.useState({status:!1,item:null}),X=()=>{q({...B,status:!1})},Y=s=>{s.preventDefault(),t({...y,tendoi:v,donvi:b})},Z=s=>{q({item:s,status:!0})},[C,k]=d.useState({status:!1,id_Delete:null}),ee=s=>{k({status:!0,id_Delete:s})},se=()=>{k({...C,status:!1})},te=()=>{k({...C,status:!1})},{register:z,handleSubmit:ae,control:E,resetField:P,watch:Ee,formState:{errors:Me}}=I({defaultValues:{tendoi:"",donvi:"",thutu:1,status:!0}});d.useEffect(()=>{(async()=>{try{let h=await Ne.getDonvis();n(h.data.map(c=>({value:c._id,label:c.tendonvi}))),f([{label:"Tất cả",value:""}].concat(h.data.map(c=>({value:c._id,label:c.tendonvi}))))}catch(h){console.log(h.message)}})()},[]),d.useEffect(()=>{(async()=>{try{r(!0);let h=await _.getDois(y);u(h.data),setTimeout(()=>{r(!1)},400)}catch{}})()},[y]);const ne=async s=>{let h={...s,queryParams:y};r(!0);try{let c=await _.addDoi(h);u(c.data.dois),setTimeout(()=>{r(!1)},400),P("tendoi"),P("thutu"),P("donvi"),P("status"),N.success(c.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(c){N.error(c.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),r(!1)}},le=async s=>{let h={...s,queryParams:y};r(!0);try{let c=await _.editDoi(h);u(c.data.dois),setTimeout(()=>{r(!1)},400),N.success(c.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(c){N.error(c.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),r(!1)}},re=async()=>{r(!0);try{let s=await _.deleteDoi(C.id_Delete,{...y});u(s.data.dois),setTimeout(()=>{r(!1)},400),k({...C,status:!1}),N.success(s.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(s){k({...C,status:!1}),N.error(s.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),r(!1)}},M=L(s=>s.authReducer.roles_quanlydoanvien);return e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ce,{color:"primary",fontSize:"large"}),e.jsx("h4",{className:"font-bold text-gray-800 text-lg",children:"Quản lý đội nghiệp vụ, công an cấp xã"})]}),M&&M.includes("thêm mô hình tổ chức")&&e.jsxs("form",{className:"mt-2 mx-8",onSubmit:ae(ne),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên đội nghiệp vụ, công an cấp xã: "]}),e.jsx("input",{...z("tendoi",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự: "]}),e.jsx("input",{...z("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái sử dụng:"}),e.jsx(O,{name:"status",control:E,render:({field:{value:s,onChange:h}})=>e.jsx(G,{checked:s,onChange:h})})]})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Đơn vị cấp trên: "]}),e.jsx(O,{control:E,name:"donvi",render:({field:s})=>e.jsx($,{required:!0,name:"donvi",options:o,className:"basic-multi-select my-4",classNamePrefix:"select",placeholder:"Vui lòng chọn đơn vị",...s})})]}),e.jsxs("div",{className:"md:space-x-2 space-y-2 md:space-y-0 md:block flex flex-col items-center",children:[e.jsxs(j,{type:"submit",sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(Q,{})," Thêm mới"]}),e.jsxs(j,{sx:{width:"220px",backgroundColor:"darkgray"},onClick:()=>l(!0),color:"info",variant:"contained",children:[e.jsx(V,{})," Chức năng tìm kiếm"]})]})]}),m&&e.jsxs("form",{onSubmit:s=>Y(s),className:"my-2 mt-4 mx-8 bg-slate-800 p-4 rounded-lg shadow-xl","data-aos":"zoom-in-down","data-aos-once":"true",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h5",{className:"text-white text-[18px] font-semibold",children:"Tìm kiếm đội công tác, công an cấp xã"}),e.jsx(D,{onClick:()=>l(!1),sx:{backgroundColor:"#ccc"},children:e.jsx(ue,{sx:{color:"white"}})})]}),e.jsxs("div",{className:"flex space-x-4 mt-4",children:[e.jsx("div",{className:"flex-col flex basis-1/2",children:e.jsx("input",{type:"text",defaultValue:v,className:`outline-none my-2 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:ring-white focus:border-white`,onChange:s=>g(s.target.value),placeholder:"Tên đội, công an cấp xã"})}),e.jsx("div",{className:"flex-col flex basis-1/2",children:e.jsx($,{name:"donvi",options:i,className:"basic-multi-select my-2",classNamePrefix:"select",placeholder:"Tất cả",onChange:s=>U(s.value)})})]}),e.jsx("div",{className:"my-2 text-center",children:e.jsxs(j,{sx:{width:"200px",backgroundColor:"slategray"},type:"submit",color:"info",variant:"contained",children:[e.jsx(V,{})," Tìm kiếm"]})})]}),e.jsx("div",{className:"mt-6 mx-8",children:e.jsx($e,{list:p,onClickOpenDialogDelete:ee,onClickOpenDialogEdit:Z})}),e.jsx(ze,{open:B.status,item:B.item,onCloseDialogEdit:X,onSubmit:le,donvis:o}),e.jsx(Ce,{open:C.status,onCloseDialogDelete:te,onConfirmDelete:re,onCancelDelete:se})]})};export{ss as default};
